/*! 
 * (smt)2 simple mouse tracking v2.2.0
 * Copyleft (cc) 2006-2013 Luis Leiva
 * http://smt2.googlecode.com & http://smt.speedzinemedia.com
 */
(function(){var c={fps:24,recTime:3600,postInterval:30,trackingServer:"",storageServer:"",warn:false,warnText:"We'd like to study your mouse activity.\nDo you agree?",cookieDays:365,layoutType:"liquid",contRecording:true,compress:true,disabled:0};var b=window.smt2fn;if(typeof b==="undefined"){throw ("Auxiliar (smt)2 functions not found")}var a={i:0,mouse:{x:0,y:0},page:{width:0,height:0},coords:{x:[],y:[],p:[]},elem:{hovered:[],clicked:[]},url:null,rec:null,userId:null,smtId:null,append:null,paused:false,clicked:false,timestamp:null,timeout:null,xmlhttp:b.createXMLHTTPObject(),ftu:1,pauseRecording:function(){a.paused=true},resumeRecording:function(){a.paused=false},getMousePos:function(f){if(!f){var f=window.event}var d=0,g=0;if(f.pageX||f.pageY){d=f.pageX;g=f.pageY}else{if(f.clientX||f.clientY){d=f.clientX+document.body.scrollLeft+document.documentElement.scrollLeft;g=f.clientY+document.body.scrollTop+document.documentElement.scrollTop}}if(d<0||!d){d=0}if(g<0||!g){g=0}a.mouse.x=d;a.mouse.y=g},getMousePosIFrame:function(g,i){a.pause=false;var f=g.pageX||g.clientX;var k=g.pageY||g.clientY;var h=i.contentDocument||i.contentWindow;if(h.body){f-=h.body.scrollLeft;k-=h.body.scrollTop}if(h.documentElement){f-=h.documentElement.scrollLeft;k-=h.documentElement.scrollTop}var j=a.getFrameOffsets(i);f+=j.left;k+=j.top;a.mouse.x=f;a.mouse.y=k},getFrameOffsets:function(g){var f=(g&&g.frameElement)?g.frameElement:g;var d=0,e=0;if(f&&f.offsetParent){do{d+=f.offsetLeft;e+=f.offsetTop}while(f=f.offsetParent)}return{left:d,top:e}},setClick:function(){a.clicked=true},releaseClick:function(){a.clicked=false},recMouse:function(){if(a.paused){return}if(a.i<=a.timeout){a.coords.x.push(a.mouse.x);a.coords.y.push(a.mouse.y);a.coords.p.push(+a.clicked)}else{clearInterval(a.rec);clearInterval(a.append)}++a.i},getCursorDataFields:function(){var d="&pagew="+a.page.width;d+="&pageh="+a.page.height;if(c.compress){d+="&xcoords="+b.LZW.compress(a.coords.x.join(","));d+="&ycoords="+b.LZW.compress(a.coords.y.join(","));d+="&clicks="+b.LZW.compress(a.coords.p.join(","));d+="&elhovered="+b.LZW.compress(a.elem.hovered.join(","));d+="&elclicked="+b.LZW.compress(a.elem.clicked.join(","));d+="&compressed=1"}else{d+="&xcoords="+a.coords.x;d+="&ycoords="+a.coords.y;d+="&clicks="+a.coords.p;d+="&elhovered="+a.elem.hovered;d+="&elclicked="+a.elem.clicked}return d},initMouseData:function(d){a.computeAvailableSpace();var e="client="+a.smtId;e+="&url="+a.url;e+="&urltitle="+document.title;e+="&cookies="+document.cookie;e+="&screenw="+screen.width;e+="&screenh="+screen.height;e+="&layout="+c.layoutType;e+="&time="+a.getBrowsingTime();e+="&fps="+c.fps;e+="&ftu="+a.ftu;e+=a.getCursorDataFields();e+="&action=store";e+="&remote="+c.storageServer;a.sendData({async:d,postdata:e,callback:a.setUserId});a.clearMouseData()},setTrackingId:function(){var d;if(b.cookies.checkCookie("smt-id")){d=b.cookies.getCookie("smt-id")}else{d=md5(String(Math.random()+(new Date()).getTime()*Math.random()));b.cookies.setCookie("smt-id",d,c.cookieDays)}a.smtId=d},setUserId:function(d){a.userId=parseInt(d);if(a.userId>0){a.append=setInterval(function(){a.appendMouseData(true)},c.postInterval*1000)}},getBrowsingTime:function(){var d=(new Date()).getTime()-a.timestamp;return d/1000},appendMouseData:function(d){if(!a.rec||a.paused){return false}var e="uid="+a.userId;e+="&time="+a.getBrowsingTime();e+=a.getCursorDataFields();e+="&action=append";e+="&remote="+c.storageServer;a.sendData({async:d,postdata:e});a.clearMouseData()},sendData:function(d){d.url=b.ensureLastURLSlash(c.trackingServer)+"core/gateway.php";d.xmlhttp=a.xmlhttp;b.sendAjaxRequest(d)},flushData:function(){if(a.userId){a.appendMouseData(false)}else{a.initMouseData(false)}},clearMouseData:function(){a.coords.x=[];a.coords.y=[];a.coords.p=[];a.elem.hovered=[];a.elem.clicked=[]},findElement:function(d){if(!d){d=window.event}b.widget.findDOMElement(d,function(e){if(d.type=="mousedown"||d.type=="touchstart"){a.elem.clicked.push(e)}else{if(d.type=="mousemove"||d.type=="touchmove"){a.elem.hovered.push(e)}}})},computeAvailableSpace:function(){var d=b.getPageSize();a.page.width=d.width;a.page.height=d.height},trackIFrames:function(l){var j=l.getElementsByTagName("iframe"),n,m,e;var o=function(f){b.addEvent(f,"mousedown",a.setClick);b.addEvent(f,"mouseup",a.releaseClick);b.addEvent(f,"touchstart",a.setClick);b.addEvent(f,"touchend",a.releaseClick)};for(var g=0,k=j.length;g<k;++g){n=(window.opera)?j[g]:j[g].contentWindow||j[g].contentDocument;if(n.attachEvent&&!window.opera){var h=j[g].cloneNode(true);j[g].parentNode.replaceChild(h,j[g]);j[g].onreadystatechange=function(d){if(this.readyState==="complete"){e=this.contentWindow;m=e.document;b.addEvent(m,"mousemove",function(f){a.getMousePosIFrame(this.parentWindow.event,this.frames.frameElement)});b.addEvent(m,"touchmove",function(f){a.getMousePosIFrame(this.parentWindow.event,this.frames.frameElement)});o(m)}}}else{if(n.frameElement){n=n.frameElement}b.addEvent(n,"load",function(d){e=d.target||d.srcElement;m=e.contentDocument;b.addEvent(m,"mousemove",function(f){a.getMousePosIFrame(f,e)});b.addEvent(m,"touchmove",function(f){a.getMousePosIFrame(f,e)});o(m)})}}},keyHandler:function(d){},init:function(){a.setTrackingId();a.computeAvailableSpace();a.url=escape(window.location.href);a.timeout=c.fps*c.recTime;var d=Math.round(1000/c.fps);a.rec=setInterval(a.recMouse,d);b.allowTrackingOnFlashObjects(document);a.trackIFrames(document);var f=function(g){if(g.touches){g=g.touches[0]||g.targetTouches[0]}a.getMousePos(g);a.findElement(g)};var e=function(g){if(g.touches){g=g.touches[0]||g.targetTouches[0]}a.setClick();a.findElement(g)};b.addEvent(document,"mousedown",e);b.addEvent(document,"mousemove",f);b.addEvent(document,"mouseup",a.releaseClick);b.addEvent(document,"touchstart",e);b.addEvent(document,"touchmove",f);b.addEvent(document,"touchend",a.releaseClick);b.addEvent(window,"resize",a.computeAvailableSpace);b.addEvent(window,"orientationchange",a.computeAvailableSpace);if(!c.contRecording){if(document.attachEvent&&!window.opera){b.addEvent(document.body,"focusout",a.pauseRecording);b.addEvent(document.body,"focusin",a.resumeRecording)}else{b.addEvent(window,"blur",a.pauseRecording);b.addEvent(window,"focus",a.resumeRecording)}}if(typeof window.onbeforeunload=="function"){b.addEvent(window,"beforeunload",a.flushData)}else{b.addEvent(window,"unload",a.flushData)}setTimeout(function(){a.initMouseData(true)},c.postInterval*1000);a.timestamp=(new Date()).getTime()}};window.smt2={methods:a,record:function(d){if(typeof d!=="undefined"){b.overrideTrackingOptions(c,d)}var j=b.cookies.getCookie("smt-ftu");if(c.disabled&&j){return}a.ftu=(!j|0);b.cookies.setCookie("smt-ftu",a.ftu,c.cookieDays);if(c.warn){var k=b.cookies.checkCookie("smt-agreed");var l=(k)?b.cookies.getCookie("smt-agreed"):window.confirm(c.warnText);if(l){b.cookies.setCookie("smt-agreed",1,c.cookieDays)}else{b.cookies.setCookie("smt-agreed",0,1);return false}}var f=document.getElementsByTagName("script");for(var g=0,n=f.length;g<n;++g){var e=f[g].src;if(/smt-record/i.test(e)){var m=e.split("/");var h=b.array.indexOf(m,"smt2");if(h&&!c.trackingServer){c.trackingServer=m.slice(0,h+1).join("/")}}}b.onDOMload(a.init)}}})();